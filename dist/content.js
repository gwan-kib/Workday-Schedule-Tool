(function(){"use strict";const F={global:!1,local:{},log:{}},oe=({global:e,local:n,log:t}={})=>{if(typeof e=="boolean"&&(F.global=e),n&&typeof n=="object")for(const[o,s]of Object.entries(n))typeof s=="boolean"&&(F.local[o]=s);if(t&&typeof t=="object")for(const[o,s]of Object.entries(t))typeof s=="boolean"&&(F.log[o]=s)},_=(e,n)=>!(!F.global||e&&F.local[e]===!1||n&&F.log[n]===!1),b=e=>{const n=e?`[Workday - Schedule Tool (file: ${e})]
`:`[Workday - Schedule Tool]
`;return{log:(i,...l)=>{let c=null,d=null;i&&typeof i=="object"&&!Array.isArray(i)?(c=i,d=l):(c=null,d=[i,...l]);const g=c?.id,h=c?.on===!0;c?.on!==!1&&(!h&&!_(e,g)||console.log(n,...d))},warn:(i,...l)=>{let c=null,d=null;i&&typeof i=="object"&&!Array.isArray(i)?(c=i,d=l):d=[i,...l];const g=c?.id,h=c?.on===!0;c?.on!==!1&&(!h&&!_(e,g)||console.log("‚ö†Ô∏è",n,...d))},error:(i,...l)=>{let c=null,d=null;i&&typeof i=="object"&&!Array.isArray(i)?(c=i,d=l):d=[i,...l];const g=c?.id,h=c?.on===!0;c?.on!==!1&&(!h&&!_(e,g)||console.log("üö©",n,...d))},on:()=>oe({local:{[e]:!0}}),off:()=>oe({local:{[e]:!1}})}},G=b("dom"),N=(e,n)=>(G.log("Querying multiple elements:",{root:e,sel:n}),Array.from(e.querySelectorAll(n))),p=(e,n,t,o)=>{e&&(G.log("Attaching event listener:",{el:e,ev:n,opts:o}),e.addEventListener(n,t,o))},ve=(e,n=300)=>{let t;return(...o)=>{G.log("Debouncing function call with delay:",{fn:e,ms:n,args:o}),clearTimeout(t),t=setTimeout(()=>e(...o),n)}},m={courses:[],filtered:[],savedSchedules:[],currentScheduleName:null,sort:{key:null,dir:1},view:{panel:"list",semester:"first"}},se=b("shadowMount"),re="Workday - Schedule Tool";function we(){let e=document.getElementById(re);return e?(se.log("Returning existing shadow root:",e),e.shadowRoot):(e=document.createElement("div"),e.id=re,e.style.all="initial",e.style.position="fixed",e.style.bottom="16px",e.style.right="16px",e.style.zIndex="999999999",e.attachShadow({mode:"open"}),document.documentElement.appendChild(e),se.log("Mounted new extension container:",e),e.shadowRoot)}const Ce=b("loadMainPanel");async function Le(e){const n=chrome.runtime.getURL("dist/panel.html"),t=["formatting/widget-base.css","formatting/widget-tabs-header.css","formatting/widget-header-tabs.css","formatting/course-list-view.css","formatting/schedule-view.css","formatting/settings-view.css","formatting/help-view.css","formatting/widget-footer.css","formatting/floating-button.css","colors/theme-tokens.css","colors/widget-base-colors.css","colors/widget-header-tabs-color.css","colors/course-list-colors.css","colors/schedule-view-colors.css","colors/settings-view-colors.css","colors/help-view-colors.css","colors/widget-footer-colors.css","colors/floating-button-colors.css","colors/settings-colors.css"],[o,...s]=await Promise.all([fetch(n).then(c=>c.text()),...t.map(c=>fetch(chrome.runtime.getURL(`dist/css/${c}`)).then(d=>d.text()))]),r=s.join(`
`);e.innerHTML="";const a=document.createElement("style");if(a.textContent=r,e.appendChild(a),!document.querySelector('link[href*="Material+Symbols"]')){const c=document.createElement("link");c.rel="stylesheet",c.href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200",document.head.appendChild(c)}const i=document.createElement("div");i.innerHTML=o,e.appendChild(i);const l={mainPanel:e.querySelector(".widget"),root:e,floatingButton:e.querySelector("#floating-button"),tableBody:e.querySelector("tbody"),tableHead:e.querySelector("thead"),searchInput:e.querySelector("#widget-search"),refreshButton:e.querySelector("#widget-refresh"),saveScheduleButton:e.querySelector("#widget-save-schedule"),exportDropdown:e.querySelector("#widget-export"),exportButton:e.querySelector("#widget-export-button"),exportMenu:e.querySelector("#widget-export-menu"),viewTabs:e.querySelectorAll(".tab-button"),views:e.querySelectorAll(".widget-panel"),scheduleGrid:e.querySelector("#schedule-grid"),semesterButtons:e.querySelectorAll(".semester-button"),footerConflicts:e.querySelector("#widget-conflicts"),savedDropdown:e.querySelector("#schedule-saved-dropdown"),savedMenu:e.querySelector("#schedule-saved-menu"),saveModal:e.querySelector("#schedule-save-modal"),saveModalTitle:e.querySelector("#schedule-modal-title"),saveModalMessage:e.querySelector("#schedule-modal-message"),saveModalField:e.querySelector("#schedule-modal-field"),saveModalInput:e.querySelector("#schedule-modal-input"),saveModalCancel:e.querySelector(".schedule-modal-cancel"),saveModalConfirm:e.querySelector(".schedule-modal-confirm"),helpButton:e.querySelector(".help"),settingsButton:e.querySelector(".settings")};return Ce.log({id:"loadMainPanel.ui"},"Loaded mainPanel UI refs",{hasMainPanel:!!l.mainPanel,hasFloatingButton:!!l.floatingButton,hasTable:!!l.tableBody&&!!l.tableHead}),l}const A=b("grid"),Y=e=>String(e||"").replace(/\u00A0/g," ").replace(/\s+/g," ").trim().toLowerCase();function ie(e){if(!e)return"";const n=e.querySelector("button[title]");return n?(n.getAttribute("title")||"").trim():(e.textContent||"").trim()}function Me(e){const t=(e?.getAttribute?.("data-automation-id")||"").match(/^columnHeader(\d+\.\d+)$/);return t?t[1]:null}function Ee(e){const n=Array.from(e.querySelectorAll('th[data-automation-id^="columnHeader"]'));A.log({id:"buildHeaderMaps.headers"},"Header elements found:",n.length);const t=n.map((i,l)=>{const c=ie(i),d=Me(i);return{el:i,pos:l,key:d,text:c,norm:Y(c)}}).filter(i=>i.text);A.log({id:"buildHeaderMaps.parsedHeaders"},"Parsed headers:",t.map(i=>({pos:i.pos,key:i.key,text:i.text,norm:i.norm})));function o(i){const l=i.map(Y);let c=t.find(d=>l.includes(d.norm));return c||(c=t.find(d=>l.some(g=>d.norm.includes(g))),c||null)}const s={instructor:["instructor","instructors"],meeting:["meeting patterns","meeting pattern"],deliveryMode:["delivery mode"],title:["title","course listing"],section:["section"],instructionalFormat:["instructional format"],startDate:["start date","start"]},r={},a={};for(const[i,l]of Object.entries(s)){const c=o(l);r[i]=c?c.key:null,a[i]=c?c.pos:-1,A.log({id:"buildHeaderMaps.map"},"Mapped header:",{key:i,needles:l,hit:c?{pos:c.pos,colKey:c.key,text:c.text}:null})}return{colMap:r,posMap:a}}function Te(){const e=N(document,`
  table,
  [role="table"],
  [role="grid"],
  div[data-automation-id*="grid"],
  div[data-automation-id*="Grid"],
  div[data-automation-id="gridContainer"],
  div[data-automation-id="responsiveDataTable"],
  div[data-automation-id="tableContainer"]
`);A.log({id:"findWorkdayGrid.roots"},"Candidate roots found:",e.length);for(const n of e){const t=N(n,`
  thead th,
  [role="columnheader"],
  div[data-automation-id*="columnHeader"],
  .wd-GridHeaderCell,
  .grid-column-header
`),o=t.map(a=>Y(ie(a))),s=o.some(a=>a.includes("section"))&&(o.some(a=>a.includes("instructor"))||o.some(a=>a.includes("meeting"))||o.some(a=>a.includes("instructional format"))||o.some(a=>a.includes("format"))||o.some(a=>a.includes("status")));if(A.log({id:"findWorkdayGrid.scanRoot"},"Scanning root:",{headerCount:t.length,looksRight:s,headerText:o}),!s)continue;const r=N(n,"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row");if(A.log({id:"findWorkdayGrid.rows"},"Rows found for matching root:",r.length),r.length)return{root:n,rows:r}}return A.log({id:"findWorkdayGrid.none"},"No matching table/grid found"),null}const q=b("sectionLinkInfo");function xe(e){let n=String(e||"").replace(/\u00A0/g," ").trim();if(q.log({id:"parseSectionLinkString.input"},"Raw input:",e),!n)return null;n=n.replace(/\s*\n\s*/g," ").trim(),q.log({id:"parseSectionLinkString.normalized"},"Normalized string:",n);const t=n.match(/^\s*([A-Z][A-Z0-9_]*\s*\d{3}[A-Z]?)\s*-\s*(.+?)\s*$/);if(!t)return q.log({id:"parseSectionLinkString.noMatch"},"String did not match expected pattern"),null;const o=t[1].trim(),s=t[2].trim();q.log({id:"parseSectionLinkString.match"},"Regex match:",{baseCode:o,rest:s});const r=s.split(/\s*[-‚Äì‚Äî]\s*/).map(c=>c.trim()).filter(Boolean);let a="",i="";a=r[0],i=r.slice(1).join(" - ").trim(),i=i.replace(/\s*:\s*/g,`:
`);const l={code:o,section_number:a,title:i,full:n};return q.log({id:"parseSectionLinkString.result"},"Parsed section link result:",l),l}const x=b("meetingPatternsInfo"),De=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,$e=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,ke=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;function Ae(e){if(!e)return x.log({id:"extractMeetingLines.missing"},"No container element provided"),[];const t=Array.from(e.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(s=>(s.getAttribute("aria-label")||"").trim()).filter(Boolean);x.log({id:"extractMeetingLines.items"},"Menu item lines:",{count:t.length});const o=t.filter(s=>De.test(s)&&$e.test(s)&&ke.test(s));return x.log({id:"extractMeetingLines.filtered"},"Filtered meeting lines:",{before:t.length,after:o.length}),o}function Ie(e){if(!e)return x.log({id:"isOnlineDelivery.missing"},"No delivery mode cell provided"),!1;const n=(e.innerText||e.textContent||"").trim();if(/online learning/i.test(n))return x.log({id:"isOnlineDelivery.match.direct"},"Matched online learning from cell text",n),!0;const t=Array.from(e.querySelectorAll('[data-automation-id="promptOption"]')),o=t.some(s=>{const r=s.getAttribute("data-automation-label")||s.getAttribute("title")||s.textContent||"";return/online learning/i.test(r)});return x.log({id:"isOnlineDelivery.match.prompts"},"Checked prompt options for online learning",{promptCount:t.length,matched:o}),o}function Be(e){const n=String(e||""),t=n.split("|").map(h=>h.trim()).filter(Boolean),s=(t.find(h=>/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/.test(h))||"").split(/\s+/).join(" / "),r=t.find(h=>/\d{1,2}:\d{2}/.test(h)&&/-/.test(h))||"",a=t.find(h=>/\([A-Z]{2,}\)/.test(h))||"",i=n.match(/\bfloor\b\s*[:\-]?\s*(-?[A-Za-z0-9]+)/i),l=n.match(/\b(room|rm)\b\s*[:\-]?\s*([A-Za-z0-9]+)/i),c=i?`Floor: ${i[1]}`:"",d=l?`Room: ${l[2]}`:"",g={days:s,time:r,location:[a,[c,d].filter(Boolean).join(" | ")].filter(Boolean).join(`
`)};return x.log({id:"formatMeetingLineForPanel"},"Formatted meeting line:",{raw:n,formatted:g}),g}function Fe(e){const n=String(e||"").split(/\r?\n(.*)/s).slice(0,2).map(t=>t.replace(/[ \t]+/g," ").trim()).filter(Boolean).join(`
`);return x.log({id:"normalizeMeetingPatternsText"},"Normalized meeting patterns text:",{beforeLen:String(e||"").length,afterLen:n.length,ogText:e,ogString:String(e||""),normalized:n}),n}function Z(e){const n=String(e||"").match(/\b(\d{4}-\d{2}-\d{2})\b/),t=n?n[1]:"";return x.log({id:"extractStartDate"},"Extracted start date:",{line:e,out:t}),t}const Ne=b("rowCellReader");function Pe(e){const o=(e.querySelector('[id^="gen-dwr-comp-"]')?.id||"").match(/^gen-dwr-comp-(\d+\.\d+)-/);return o?o[1]:null}function Re(e,n){const{colMap:t}=n||{},o=N(e,"td, [role='gridcell']");Ne.log({id:"createRowCellReader.start"},"Creating row cell reader:",{cellCount:o.length});const s=new Map;o.forEach(i=>{const l=Pe(i);l&&!s.has(l)&&s.set(l,i)});const r=i=>{const l=t?.[i];return l==null?null:s.get(l)||null};return{cellsInRow:o,cellByCol:s,getCellByHeader:r,readCellTextByHeader:i=>(r(i)?.innerText||"").trim()}}const v=b("courseExtraction");async function ae(){v.log({id:"extractCoursesData.start"},"Starting course extraction");const e=Te();let n=[];if(v.log({id:"extractCoursesData.tables"},"findWorkdayGrid() result:",e?{hasRoot:!!e.root,rowCount:e.rows?.length||0}:null),e){const o=Ee(e.root);v.log({id:"extractCoursesData.headerMaps"},"Built header maps:",o);for(const s of e.rows){const r=Oe(s,o);r&&(r.code||r.title)&&Object.values(r).join("").trim()&&n.push(r)}}const t=qe(n);return v.log({id:"extractCoursesData.done"},"Extraction complete:",{total:n.length,unique:t.length}),t}function qe(e){const n=s=>[s.code,s.title,s.section_number].join("|").toLowerCase(),t=new Set,o=[];for(const s of e){const r=n(s);t.has(r)||(t.add(r),o.push(s))}return v.log({id:"removeDuplicateCourses"},"Deduped courses:",{allCourses:e,UniqueCourses:o,removed:e.length-o.length}),o}function Oe(e,n){const{getCellByHeader:t,readCellTextByHeader:o}=Re(e,n);v.log({id:"extractFromRow.start"},"Extracting row");const s=N(e,'[data-automation-id="promptOption"]'),r=s.find(w=>{const ne=w.getAttribute("data-automation-label")||w.getAttribute("title")||w.getAttribute("aria-label")||w.textContent||"";return/^[A-Z][A-Z0-9_]*\s*\d{2,3}-/.test(ne)}),a=r&&(r.getAttribute("data-automation-label")||r.getAttribute("title")||r.getAttribute("aria-label")||r.textContent)||"",i=xe(a);if(!i)return v.warn({id:"extractFromRow.skip"},"Skipping row: no parsable promptOption",{promptOptions:s.length,sectionLinkString:a}),null;v.log({id:"extractFromRow.sectionLink"},"Section link:",{promptOptions:s.length,hasMatch:!!r,sectionLinkString:a});const l=o("instructionalFormat"),c=o("startDate"),d=i.code,g=i.title,h=i.section_number;v.log({id:"extractFromRow.coreParse"},"Core parse result:",{code:d,title:g,section_number:h});const u=w=>/\b(laboratory)\b/i.test(String(w||"")),f=w=>/\bseminar\b/i.test(String(w||"")),C=w=>/\bdiscussion\b/i.test(String(w||"")),S=u(l),y=f(l),M=C(l);let B="N/A";if(!S&&!y&&(B=o("instructor"),!B))return v.warn({id:"extractFromRow.skip"},"Skipping row: missing instructor cell",{code:d,section_number:h}),null;const te=t("meeting");if(!te)return v.warn({id:"extractFromRow.skip"},"Skipping row: missing meeting cell",{code:d,section_number:h}),null;const L=Ae(te)||[];if(!L.length)return v.warn({id:"extractFromRow.skip"},"Skipping row: no meeting lines found in meeting cell",{code:d,section_number:h}),null;const R=Be(L[0]),j=t("deliveryMode"),H=j?Ie(j):!1;H&&(R.location="Online");let E=[R.days,R.time].filter(Boolean).join(" | ");E+=`
${R.location||(H?"Online":"")}`;const W=Z(L[0])||Z(c),T={code:d,title:g,section_number:h,instructor:B,meeting:Fe(E),instructionalFormat:(l||"").trim(),startDate:W,meetingLines:L,isLab:S,isSeminar:y,isDiscussion:M};return v.log({id:"extractFromRow.result"},"Extracted course:",{code:T.code,title:T.title,section_number:T.section_number,isLab:T.isLab,isSeminar:T.isSeminar,isDiscussion:T.isDiscussion,isOnline:H}),T}const He=b("renderCourseRows"),$=e=>String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");function Ue(e){return String(e||"").replace(/[\u00A0\u200B-\u200D\uFEFF]/g," ").replace(/[ \t]+\n/g,`
`).replace(/\n[ \t]+/g,`
`).replace(/\n{2,}/g,`
`).trim()}function je(e){return e.isLab?"[Laboratory]":e.isSeminar?"[Seminar]":e.isDiscussion?"[Discussion]":""}function We(e){const n=Ue(e).split(`
`),t=(n[0]||"").trim(),o=n.slice(1).map(s=>s.replace(/[\u00A0\u200B-\u200D\uFEFF]/g,"").trim()).filter(Boolean).join(`
`);return{main:t,sub:o}}function z(e,n){e.tableBody.innerHTML="";const t=document.createDocumentFragment();(n||[]).forEach(o=>{const s=document.createElement("tr"),r=je(o),{main:a,sub:i}=We(o.meeting);s.innerHTML=`
      <td class="title">
        <div class="title-main">${$(o.title||"")}</div>
        ${r?`<div class="muted">${$(r)}</div>`:""}
      </td>
      <td class="code">${$(o.code||"")}</td>
      <td class="sect">${$((o.section_number||"").trim())}</td>
      <td class="instructor">${$(o.instructor||"")}</td>
      <td class="meeting">
        ${a?`<span class="meeting-pill">${$(a)}</span>`:""}
        ${i?`<div class="meeting-sub">${$(i)}</div>`:""}
      </td>
      <td class="instructionalFormat">${$(o.instructionalFormat||"")}</td>
    `,t.appendChild(s)}),e.tableBody.appendChild(t),He.log({id:"renderCourseRows.done"},"Rendered course rows",{count:(n||[]).length})}const _e=b("mainPanelInteractions");function le(e){const n=(e||"").trim().toLowerCase();if(!n){m.filtered=[...m.courses];return}const t=["code","title","section_number","instructor","meeting","instructionalFormat"];m.filtered=m.courses.filter(o=>t.some(s=>String(o?.[s]||"").toLowerCase().includes(n)))}function V(e){if(!e)return;const n=m.sort.key===e?-m.sort.dir:1;m.sort={key:e,dir:n};const t=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});m.filtered.sort((o,s)=>n*t.compare(o?.[e]||"",s?.[e]||""))}function Ge(e){const n=N(e.tableHead,"th[data-key]");n.forEach(t=>{p(t,"click",()=>{const o=t.getAttribute("data-key");V(o),z(e,m.filtered),n.forEach(s=>s.classList.remove("sorted-asc","sorted-desc")),t.classList.add(m.sort.dir===1?"sorted-asc":"sorted-desc"),_e.log({id:"wireTableSorting.click"},"Sorted via header",{key:o,dir:m.sort.dir})})})}const Ye=b("scheduleView"),P=["Mon","Tue","Wed","Thu","Fri"],ce=8,X=21,U=30,I=[];for(let e=ce;e<X;e++)I.push(e*60),I.push(e*60+30);I.push(X*60);const Ze=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/g,ze=/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/gi,de={first:["09","08"],second:["01","12"]};function ue(e){const n=String(e||"").trim().match(/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/i);if(!n)return null;let t=Number.parseInt(n[1],10);const o=Number.parseInt(n[2],10),s=n[3].toLowerCase();return s==="p"&&t!==12&&(t+=12),s==="a"&&t===12&&(t=0),t*60+o}function Ve(e){const n=String(e||"").match(Ze)||[],t=String(e||"").match(ze)||[];if(n.length===0||t.length<2)return null;const o=ue(t[0]),s=ue(t[1]);return o==null||s==null||s<=o?null:{days:[...new Set(n)],startMinutes:o,endMinutes:s,timeLabel:`${t[0]} - ${t[1]}`}}function Xe(e){if(!e)return null;const n=e.split("-")[1];return de.first.includes(n)?"first":de.second.includes(n)?"second":null}function me(e){const n=ce*60,t=X*60;return Math.max(n,Math.min(t,e))}function Je(e){return Math.floor(e/U)*U}function Ke(e){return Math.ceil(e/U)*U}function fe(e){return I.indexOf(e)}function Qe(e,n){const t=new Map;P.forEach(r=>t.set(r,[]));const o=new Set;let s=0;return(e||[]).forEach(r=>{const a=r.startDate||Z(r.meetingLines?.[0])||"";if(Xe(a)!==n)return;const l=r.meetingLines?.length?r.meetingLines:[],c=r.isLab?"[Laboratory]":r.isSeminar?"[Seminar]":r.isDiscussion?"[Discussion]":"";l.forEach(d=>{const g=Ve(d);if(!g)return;let h=Je(me(g.startMinutes)),u=Ke(me(g.endMinutes));const f=fe(h),C=fe(u);if(f===-1||C===-1||C<=f)return;const S=C-f;g.days.forEach(y=>{if(!t.has(y))return;const M=[y,r.code||"",r.title||"",g.timeLabel,f,S].join("|");o.has(M)||(o.add(M),t.get(y).push({id:s++,code:r.code||"",title:r.title||"",label:c,timeLabel:g.timeLabel,rowStart:f,rowSpan:S,startIdx:f,endIdx:C}))})})}),P.forEach(r=>{t.get(r).sort((a,i)=>a.startIdx-i.startIdx||a.endIdx-i.endIdx)}),t}function et(e){const n=new Map;return P.forEach(t=>{const o=(e.get(t)||[]).slice().sort((i,l)=>i.startIdx-l.startIdx||i.endIdx-l.endIdx),s=[];let r=null,a=null;for(let i=0;i<I.length-1;i++){const l=o.filter(d=>d.startIdx<=i&&d.endIdx>i),c=l.length?l.map(d=>d.id).sort((d,g)=>d-g).join("|"):null;if(!c){r&&s.push(r),r=null,a=null;continue}if(r&&c===a){r.end=i+1;continue}r&&s.push(r),r={start:i,end:i+1,events:l,hasConflict:l.length>1},a=c}r&&s.push(r),n.set(t,s)}),n}function tt(e){const n=new Set,t=[];return e.forEach(o=>{o.forEach(s=>{if(!s.hasConflict)return;const r=[...new Set(s.events.map(i=>i.code||i.title).filter(Boolean))];if(r.length<2)return;r.sort((i,l)=>i.localeCompare(l));const a=r.join("|");n.has(a)||(n.add(a),t.push(r))})}),t}function nt(e,n){if(!e?.footerConflicts)return;if(!n.length){e.footerConflicts.textContent="";return}const t=n.map(o=>`[${o.join(", ")}]`).join(" ");e.footerConflicts.textContent=`‚ö†Ô∏è The following classes are in conflict: ${t}`}function ot(e){const n=Math.floor(e/60),t=e%60;return`${String(n)}:${String(t).padStart(2,"0")}`}function st(){const e=document.createElement("div");e.className="schedule-table-wrap";const n=document.createElement("table");n.className="schedule-table";const t=document.createElement("thead"),o=document.createElement("tr");o.innerHTML=`
    <th class="schedule-time"></th>
    ${P.map(a=>`<th class="schedule-day-head" data-day="${a}">${a}</th>`).join("")}
  `,t.appendChild(o),n.appendChild(t);const s=document.createElement("tbody");for(let a=0;a<I.length;a++){const i=document.createElement("tr"),l=document.createElement("td");l.className="schedule-time",l.textContent=ot(I[a]),i.appendChild(l),P.forEach(c=>{const d=document.createElement("td");d.className="schedule-cell",d.dataset.day=c,d.dataset.row=String(a);const g=document.createElement("div");g.className="schedule-cell-inner",d.appendChild(g),i.appendChild(d)}),s.appendChild(i)}n.appendChild(s),e.appendChild(n);const r=document.createElement("div");return r.className="schedule-overlay",e.appendChild(r),e}function rt(e,n){const t=e.querySelector(".schedule-overlay");t.innerHTML="";const o=e.querySelector(".schedule-table"),s=o.querySelector("tbody tr"),r=o.querySelector('tbody tr td.schedule-cell[data-day="Mon"]'),a=o.querySelector("thead th.schedule-time");if(!s||!r||!a)return;const i=a.getBoundingClientRect().width,l=r.getBoundingClientRect().width,c=o.querySelector("thead").getBoundingClientRect().height,d=s.getBoundingClientRect().height,g=getComputedStyle(r),h=parseFloat(g.borderLeftWidth)||0,u=parseFloat(g.borderTopWidth)||0,f=parseFloat(g.borderRightWidth)||0,C=parseFloat(g.borderBottomWidth)||0,S=(h+f)/2,y=(u+C)/2;P.forEach((M,B)=>{(n.get(M)||[]).forEach(L=>{const R=i+B*l,j=c+L.rowStart*d,H=L.rowSpan*d,E=document.createElement("div");E.className="schedule-entry-float",E.style.left=`${R+h}px`,E.style.top=`${j+u}px`,E.style.width=`${l-S}px`,E.style.height=`${H-y}px`;const W=document.createElement("div");W.className="schedule-entry-overlap-layer",E.appendChild(W);const T=document.createElement("div");T.className="schedule-entry-text";const w=L.code||L.title,ne=L.label?`${w} ${L.label}`:w;T.innerHTML=`
        <div class="schedule-entry-title">${ne}</div>
        <div class="schedule-entry-time">${L.timeLabel}</div>
      `,E.appendChild(T),t.appendChild(E)})})}function it(e,n,t){const o=e?.scheduleGrid||e?.schedulePanel||e?.scheduleContainer||e?.scheduleView||e?.schedule;if(!o){Ye.warn("renderSchedule: no schedule host found on ui");return}const s=Qe(n||[],t),r=et(s),a=tt(r);o.innerHTML="";const i=st();o.appendChild(i),rt(i,s),nt(e,a)}const k=b("export-ics"),J="America/Vancouver",at=e=>{const n=e.getUTCFullYear(),t=D(e.getUTCMonth()+1),o=D(e.getUTCDate()),s=D(e.getUTCHours()),r=D(e.getUTCMinutes()),a=D(e.getUTCSeconds());return k.log("Formatting UTC Date:",{y:n,m:t,d:o,hh:s,mm:r,ss:a}),`${n}${t}${o}T${s}${r}${a}Z`},ge={Mon:"MO",Tue:"TU",Wed:"WE",Thu:"TH",Fri:"FR",Sat:"SA",Sun:"SU"},lt=/(\d{4}-\d{2}-\d{2})\s*-\s*(\d{4}-\d{2}-\d{2})/,ct=/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?\s*-\s*(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/i,dt=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/g,D=e=>String(e).padStart(2,"0"),ut=e=>{const n=e.getFullYear(),t=D(e.getMonth()+1),o=D(e.getDate());return k.log("Formatted Date:",{year:n,month:t,day:o}),`${n}${t}${o}`},he=e=>{const n=ut(e),t=D(e.getHours()),o=D(e.getMinutes());return k.log("Formatted DateTime:",{datePart:n,hours:t,minutes:o}),`${n}T${t}${o}00`},pe=(e,n,t)=>{let o=Number.parseInt(e,10);const s=Number.parseInt(n,10),r=t.toLowerCase();return k.log("Parsing Time:",{hours:o,minutes:s,period:r}),r==="p"&&o!==12&&(o+=12),r==="a"&&o===12&&(o=0),{hours:o,minutes:s}},mt=e=>{const n=String(e||"").match(lt),t=String(e||"").match(ct),o=String(e||"").match(dt)||[];if(!n||!t||!o.length)return null;k.log("Parsed Meeting Line:",{dateMatch:n,timeMatch:t,days:o});const s=n[1],r=n[2],a=pe(t[1],t[2],t[3]),i=pe(t[4],t[5],t[6]),l=[...new Set(o.map(c=>ge[c]).filter(Boolean))];return{startDate:s,endDate:r,days:l,startTime:a,endTime:i}},ft=e=>{const n=String(e||"").split("|").map(s=>s.trim()).filter(Boolean),t=n.find(s=>/\([A-Z]{2,}\)/.test(s));if(t)return t;const o=n.find(s=>/online/i.test(s));return o||""},gt=(e,n)=>{const t=new Date(`${e}T00:00:00`);for(let o=0;o<7;o+=1){const s=new Date(t);s.setDate(t.getDate()+o);const r=Object.values(ge)[s.getDay()===0?6:s.getDay()-1];if(n.includes(r))return s}return t},ht=(e,n)=>{const t=mt(n);if(!t)return null;const o=gt(t.startDate,t.days),s=new Date(o);s.setHours(t.startTime.hours,t.startTime.minutes,0,0);const r=new Date(o);r.setHours(t.endTime.hours,t.endTime.minutes,0,0);const a=[e.code,e.title].filter(Boolean),i=[e.title?`Title: ${e.title}`:null,e.code?`Code: ${e.code}`:null,e.section_number?`Section: ${e.section_number}`:null,e.instructor?`Instructor: ${e.instructor}`:null,e.instructionalFormat?`Format: ${e.instructionalFormat}`:null,e.meeting?`Meeting: ${e.meeting}`:null].filter(Boolean),l=new Date(`${t.endDate}T23:59:59`),c=at(l);return k.log("Built Class Event:",{course:e,parsed:t,startDate:s,endDate:r,summaryParts:a,descriptionLines:i,untilDate:c}),{uid:`${e.code||"course"}-${Date.now()}-${Math.random().toString(16).slice(2)}`,summary:a.join(" - ")||"Scheduled Course",description:i.join("\\n"),location:ft(n),dtstart:he(s),dtend:he(r),rrule:`FREQ=WEEKLY;BYDAY=${t.days.join(",")};UNTIL=${c}`}},pt=e=>{const n=[];e.forEach(o=>{(o.meetingLines?.length?o.meetingLines:[]).forEach(r=>{const a=ht(o,r);a&&n.push(a)})});const t=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Workday Extension//Schedule Export//EN","CALSCALE:GREGORIAN",`X-WR-TIMEZONE:${J}`];return n.forEach(o=>{t.push("BEGIN:VEVENT"),t.push(`UID:${o.uid}`),t.push(`SUMMARY:${o.summary}`),o.description&&t.push(`DESCRIPTION:${o.description}`),o.location&&t.push(`LOCATION:${o.location}`),t.push(`DTSTART;TZID=${J}:${o.dtstart}`),t.push(`DTEND;TZID=${J}:${o.dtend}`),t.push(`RRULE:${o.rrule}`),t.push("END:VEVENT")}),t.push("END:VCALENDAR"),k.log("ICS File Generated:",t),t.join(`\r
`)};function St(e){const n=pt(m.filtered||[]),t=new Blob([n],{type:"text/calendar;charset=utf-8"}),o=URL.createObjectURL(t),s=document.createElement("a");s.href=o;const r=e?`${"[WST] "+e.replace(/[\\/:*?"<>|]/g,"-")}.ics`:"[WST] Schedule.ics";s.download=r,document.body.appendChild(s),s.click(),k.log("Download Triggered for ICS file"),setTimeout(()=>{URL.revokeObjectURL(o),s.remove()},100)}const K=b("scheduleStorage"),O="wdSavedSchedules",Se=10,yt=e=>typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e||[])),Q=e=>Array.isArray(e)?e.filter(n=>n&&Array.isArray(n.courses)).map(n=>({id:n.id,name:n.name||"Untitled",savedAt:n.savedAt||new Date().toISOString(),courses:n.courses})):[],ye=typeof chrome<"u"&&chrome.storage&&chrome.storage.local;async function bt(){if(ye)return new Promise(e=>{chrome.storage.local.get([O],n=>{e(Q(n?.[O]||[]))})});try{const e=localStorage.getItem(O);return e?Q(JSON.parse(e)):[]}catch(e){return K.error("Failed to load schedules",e),[]}}async function be(e){const n=Q(e);if(ye)return new Promise(t=>{chrome.storage.local.set({[O]:n},()=>t())});try{localStorage.setItem(O,JSON.stringify(n))}catch(t){K.error("Failed to save schedules",t)}}function vt(e,n){return{id:typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,name:e||"Untitled",savedAt:new Date().toISOString(),courses:yt(n||[])}}function wt(e){const n=e.courses?.length||0,t=new Date(e.savedAt),o=Number.isNaN(t.getTime())?e.savedAt:t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"});return`${n} courses ¬∑ Saved ${o}`}function ee(e,n){if(e.savedMenu){if(e.savedMenu.innerHTML="",!n.length){const t=document.createElement("div");t.className="schedule-saved-empty",t.textContent="No saved schedules yet.",e.savedMenu.appendChild(t);return}n.forEach(t=>{const o=document.createElement("div");o.className="schedule-saved-card",o.dataset.id=t.id;const s=document.createElement("div");s.className="schedule-saved-card-header";const r=document.createElement("div"),a=document.createElement("div");a.className="schedule-saved-title",a.textContent=t.name;const i=document.createElement("div");i.className="schedule-saved-meta",i.textContent=wt(t),r.appendChild(a),r.appendChild(i),s.appendChild(r);const l=document.createElement("div");l.className="schedule-saved-actions";const c=document.createElement("button");c.type="button",c.className="schedule-saved-action",c.dataset.action="load",c.textContent="Load";const d=document.createElement("button");d.type="button",d.className="schedule-saved-action delete",d.dataset.action="delete",d.textContent="Delete",l.appendChild(c),l.appendChild(d),o.appendChild(s),o.appendChild(l),e.savedMenu.appendChild(o)}),K.log({id:"renderSavedSchedules.done"},"Rendered saved schedules",{count:n.length})}}function Ct(e){return(e?.length||0)<Se}function Lt(){return Se}(()=>{console.log("[WD] content script loaded");async function e(){const n=we(),t=await Le(n),o=()=>{it(t,m.filtered,m.view.semester)},s=()=>{V(m.sort.key||"code"),z(t,m.filtered),o()},r=u=>{m.view.panel=u,t.views.forEach(f=>f.classList.toggle("is-active",f.dataset.panel===u)),t.viewTabs.forEach(f=>f.classList.toggle("is-active",f.dataset.panel===u)),t.mainPanel.classList.toggle("is-schedule-view",u==="schedule"),t.mainPanel.classList.toggle("is-settings-view",u==="settings"),t.mainPanel.classList.toggle("is-help-view",u==="help")},a=()=>{t.floatingButton.classList.toggle("is-collapsed",t.mainPanel.classList.contains("is-hidden"))},i=()=>{t.mainPanel.classList.toggle("is-hidden"),a()};a();let l=null;const c=u=>{t.saveModal&&(t.saveModal.classList.add("is-hidden"),t.saveModal.setAttribute("aria-hidden","true"),l&&(l(u),l=null))},d=({title:u,message:f,confirmLabel:C="Save",showInput:S=!0,showCancel:y=!0})=>t.saveModal?(t.saveModalTitle.textContent=u,t.saveModalMessage.textContent=f,t.saveModalConfirm.textContent=C,t.saveModalField.classList.toggle("is-hidden",!S),t.saveModalCancel.classList.toggle("is-hidden",!y),t.saveModalInput.value="",t.saveModalInput.classList.remove("is-invalid"),t.saveModal.classList.remove("is-hidden"),t.saveModal.setAttribute("aria-hidden","false"),S?t.saveModalInput.focus():t.saveModalConfirm.focus(),new Promise(M=>{l=M})):Promise.resolve(null);t.saveModal&&(p(t.saveModal,"click",u=>{if(u.target===t.saveModal)return c(null);const f=u.target.closest("[data-action]")?.dataset.action;if(f){if(f==="close"||f==="cancel")return c(null);if(f==="confirm"){if(!t.saveModalField.classList.contains("is-hidden")){const S=t.saveModalInput.value.trim();if(!S){t.saveModalInput.classList.add("is-invalid"),t.saveModalInput.focus();return}return c(S)}return c(!0)}}}),p(t.saveModalInput,"input",()=>t.saveModalInput.classList.remove("is-invalid")),p(t.saveModalInput,"keydown",u=>{u.key==="Enter"&&t.saveModalConfirm.click()}),p(document,"keydown",u=>{u.key==="Escape"&&!t.saveModal.classList.contains("is-hidden")&&c(null)})),t.viewTabs.forEach(u=>{p(u,"click",()=>{r(u.dataset.panel),u.dataset.panel==="schedule"&&o()})}),t.semesterButtons.forEach(u=>{p(u,"click",()=>{m.view.semester=u.dataset.semester,t.semesterButtons.forEach(f=>f.classList.toggle("is-active",f.dataset.semester===m.view.semester)),o()})}),p(t.floatingButton,"click",i);const g=u=>{!t.exportDropdown||!t.exportButton||(t.exportDropdown.classList.toggle("is-open",u),t.exportButton.setAttribute("aria-expanded",String(u)))};p(t.exportButton,"click",()=>{const u=t.exportDropdown.classList.contains("is-open");g(!u)}),p(document,"click",u=>{const f=u.composedPath?u.composedPath():[];t.exportDropdown?.classList.contains("is-open")&&!f.includes(t.exportDropdown)&&g(!1),t.savedDropdown?.open&&!f.includes(t.savedDropdown)&&(t.savedDropdown.open=!1)}),chrome.runtime.onMessage.addListener(u=>{u?.type==="TOGGLE_WIDGET"&&i()}),p(t.refreshButton,"click",async()=>{t.refreshButton.classList.remove("rotate"),t.refreshButton.offsetWidth,t.refreshButton.classList.add("rotate"),m.courses=await ae(),m.currentScheduleName=null,le(t.searchInput.value),s()});const h=async u=>{u==="ics"&&St(m.currentScheduleName)};p(t.exportMenu,"click",async u=>{const f=u.target.closest("[data-export]");f&&(g(!1),await h(f.dataset.export))}),p(t.saveScheduleButton,"click",async()=>{if(!Ct(m.savedSchedules)){await d({title:"Schedule limit reached",message:`You can only save up to ${Lt()} schedules. Delete one to save another.`,confirmLabel:"Got it",showInput:!1,showCancel:!1});return}const u=await d({title:"Save schedule",message:"Name this schedule so you can find it later.",confirmLabel:"Save",showInput:!0,showCancel:!0});if(!u)return;const f=vt(u,m.filtered);m.savedSchedules=[f,...m.savedSchedules],await be(m.savedSchedules),ee(t,m.savedSchedules),t.savedDropdown&&(t.savedDropdown.open=!0)}),p(t.savedMenu,"click",async u=>{const f=u.target.closest("[data-action]");if(!f)return;const S=f.closest(".schedule-saved-card")?.dataset.id;if(!S)return;const y=m.savedSchedules.find(M=>M.id===S);if(y){if(f.dataset.action==="delete"){if(!await d({title:"Permanently Delete Schedule?",message:`This action will permanently delete "${y.name}".`,confirmLabel:"Delete",showInput:!1,showCancel:!0}))return;m.savedSchedules=m.savedSchedules.filter(B=>B.id!==S),await be(m.savedSchedules),ee(t,m.savedSchedules);return}m.currentScheduleName=y.name,m.courses=[...y.courses],m.filtered=[...y.courses],t.searchInput.value="",s(),r("schedule"),t.savedDropdown&&(t.savedDropdown.open=!1)}}),p(t.settingsButton,"click",()=>{t.mainPanel.classList.remove("is-hidden"),t.floatingButton.classList.remove("is-collapsed"),r("settings")}),p(t.helpButton,"click",()=>{t.mainPanel.classList.remove("is-hidden"),t.floatingButton.classList.remove("is-collapsed"),r("help")}),p(t.searchInput,"input",ve(()=>{le(t.searchInput.value),s()},100)),Ge(t),m.savedSchedules=await bt(),ee(t,m.savedSchedules),m.courses=await ae(),m.filtered=[...m.courses],m.sort=m.sort||{key:"code",dir:1},V("code"),z(t,m.filtered),o(),r(m.view.panel)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e,{once:!0}):e()})()})();
//# sourceMappingURL=content.js.map
